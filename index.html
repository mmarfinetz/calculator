<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Plumbing Price Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .calculator-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .calculator-body {
            padding: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .input-section:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .input-label {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .input-help {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            margin-left: 40px;
            font-style: italic;
        }
        
        .input-wrapper {
            position: relative;
            margin-left: 40px;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 15px 15px 15px 45px;
            font-size: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: white;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            margin-left: 40px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 16px;
            background: #e8eaf6;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: 500;
        }
        
        .quick-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .results-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            margin-top: 30px;
        }
        
        .breakdown {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .breakdown.show {
            display: block;
        }
        
        .show-breakdown-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 20px;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .show-breakdown-btn:hover {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }
        
        .show-breakdown-btn.active {
            background: white;
            color: #667eea;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .breakdown-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .breakdown-value {
            font-size: 16px;
            font-weight: 600;
        }
        
        .final-price {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .final-price-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .final-price-amount {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            line-height: 1;
        }
        
        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .warning-icon {
            font-size: 24px;
        }
        
        .reset-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .reset-button:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
        
        /* Slider Styles */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-track {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
        }
        
        input[type="range"]::-moz-range-track {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: #ffc107;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            margin-top: -8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            appearance: none;
            background: #ffc107;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input[type="range"]:hover::-webkit-slider-thumb {
            background: #ffb300;
            transform: scale(1.1);
        }
        
        input[type="range"]:hover::-moz-range-thumb {
            background: #ffb300;
            transform: scale(1.1);
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 24px;
            }
            
            .final-price-amount {
                font-size: 36px;
            }
            
            .quick-buttons {
                margin-left: 0;
            }
            
            .input-wrapper {
                margin-left: 0;
            }
            
            .input-help {
                margin-left: 0;
            }
        }
        
        @media print {
            body {
                background: white;
            }

            .calculator-container {
                box-shadow: none;
            }

            .reset-button {
                display: none;
            }
        }

        .setup-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #2196f3;
        }

        .setup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .setup-title {
            font-size: 18px;
            font-weight: 600;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setup-toggle {
            font-size: 24px;
            transition: transform 0.3s ease;
        }

        .setup-toggle.open {
            transform: rotate(180deg);
        }

        .setup-content {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #2196f3;
        }

        .setup-content.show {
            display: block;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .setup-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setup-label {
            font-size: 12px;
            font-weight: 600;
            color: #1976d2;
            text-transform: uppercase;
        }

        .setup-help {
            font-size: 11px;
            color: #666;
            font-style: italic;
        }

        .setup-input {
            padding: 10px;
            border: 2px solid #90caf9;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .setup-input:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .payment-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .payment-toggle input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .payment-toggle label {
            cursor: pointer;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <h1>üîß Easy Price Calculator</h1>
            <p>Marfinetz Plumbing Company</p>
        </div>

        <div class="calculator-body">
            <!-- Setup Section -->
            <div class="setup-section">
                <div class="setup-header" onclick="toggleSetup()">
                    <div class="setup-title">
                        <span>‚öôÔ∏è</span>
                        <span>Monthly Model Parameters</span>
                    </div>
                    <span class="setup-toggle" id="setupToggle">‚ñº</span>
                </div>
                <div class="setup-content" id="setupContent">
                    <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                        These parameters drive the base day-rate formula. Edit once per month, then quote all jobs using the calculated rates.
                    </p>
                    <div class="setup-grid">
                        <div class="setup-item">
                            <label class="setup-label">F - Fixed Costs</label>
                            <div class="setup-help">Monthly fixed costs ($)</div>
                            <input type="number" id="setupF" class="setup-input" value="7739" step="1" min="0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">P - Target Profit</label>
                            <div class="setup-help">Monthly profit goal ($)</div>
                            <input type="number" id="setupP" class="setup-input" value="5000" step="100" min="0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">D - Billable Days</label>
                            <div class="setup-help">Expected crew-days/month</div>
                            <input type="number" id="setupD" class="setup-input" value="20" step="1" min="1" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">S<sub>c</sub> - Safety Factor</label>
                            <div class="setup-help">Capacity safety (0.0-1.0)</div>
                            <input type="number" id="setupSc" class="setup-input" value="0.85" step="0.01" min="0.1" max="1.0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">C<sub>b</sub> - Overhead Cushion</label>
                            <div class="setup-help">Base rate cushion (0.10 = 10%)</div>
                            <input type="number" id="setupCb" class="setup-input" value="0.10" step="0.01" min="0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">C<sub>m</sub> - Materials Cushion</label>
                            <div class="setup-help">Materials markup (0.15 = 15%)</div>
                            <input type="number" id="setupCm" class="setup-input" value="0.15" step="0.01" min="0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">f - Card Fee</label>
                            <div class="setup-help">Payment fee (0.03 = 3%)</div>
                            <input type="number" id="setupF_fee" class="setup-input" value="0.03" step="0.001" min="0" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">H<sub>day</sub> - Hours/Day</label>
                            <div class="setup-help">Billable hours per day</div>
                            <input type="number" id="setupHday" class="setup-input" value="7.5" step="0.5" min="1" onchange="saveSetup()">
                        </div>
                        <div class="setup-item">
                            <label class="setup-label">Crew Size</label>
                            <div class="setup-help">Default crew size</div>
                            <input type="number" id="setupCrewSize" class="setup-input" value="2" step="1" min="1" onchange="saveSetup()">
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                        <div style="font-weight: 600; margin-bottom: 5px; color: #856404;">üìä Calculated Rates:</div>
                        <div style="font-size: 14px; color: #856404;">
                            <strong>B<sub>day</sub></strong> (base day-rate) = <span id="calcBday">$0</span> |
                            <strong>B<sub>person-hour</sub></strong> = <span id="calcBpersonHour">$0</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Hours Input -->
            <div class="input-section">
                <div class="input-label">
                    <span class="step-number">1</span>
                    How many hours will the job take?
                </div>
                <div class="input-help">Include travel time and setup</div>
                <div class="input-wrapper">
                    <span class="input-icon">‚è±Ô∏è</span>
                    <input type="number" id="hours" placeholder="0" step="0.5" min="0">
                </div>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="setHours(0.5)">30 min</button>
                    <button class="quick-btn" onclick="setHours(1)">1 hour</button>
                    <button class="quick-btn" onclick="setHours(2)">2 hours</button>
                    <button class="quick-btn" onclick="setHours(4)">Half day</button>
                    <button class="quick-btn" onclick="setHours(8)">Full day</button>
                </div>
                <!-- Multi-day toggle -->
                <div style="margin-top: 15px; margin-left: 40px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="multiDay" onchange="toggleMultiDay()" style="width: 20px; height: 20px;">
                        <span style="font-weight: 600; color: #667eea;">üìÖ This is a multi-day job</span>
                    </label>
                </div>
                <div id="multiDayInput" style="display: none; margin-top: 15px; margin-left: 40px; padding: 15px; background: #e8eaf6; border-radius: 10px;">
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 14px; color: #666; display: block; margin-bottom: 5px;">Number of crew members:</label>
                        <input type="number" id="crewSize" placeholder="1" value="1" min="1" step="1" style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    </div>
                    <div>
                        <label style="font-size: 14px; color: #666; display: block; margin-bottom: 5px;">Number of days:</label>
                        <input type="number" id="days" placeholder="1" value="1" min="1" step="0.5" style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    </div>
                    <div class="quick-buttons" style="margin-top: 10px;">
                        <button class="quick-btn" onclick="setMultiDay(1, 2)">1 person, 2 days</button>
                        <button class="quick-btn" onclick="setMultiDay(2, 2)">2 crew, 2 days</button>
                        <button class="quick-btn" onclick="setMultiDay(2, 3)">2 crew, 3 days</button>
                    </div>
                </div>
            </div>
            
            <!-- Materials Input -->
            <div class="input-section">
                <div class="input-label">
                    <span class="step-number">2</span>
                    Cost of materials/parts?
                </div>
                <div class="input-help">What you paid for parts (we'll add cushion automatically)</div>
                <div class="input-wrapper">
                    <span class="input-icon">üíµ</span>
                    <input type="number" id="materials" placeholder="0" step="10" min="0">
                </div>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="setMaterials(25)">$25</button>
                    <button class="quick-btn" onclick="setMaterials(50)">$50</button>
                    <button class="quick-btn" onclick="setMaterials(100)">$100</button>
                    <button class="quick-btn" onclick="setMaterials(200)">$200</button>
                    <button class="quick-btn" onclick="setMaterials(500)">$500</button>
                </div>
            </div>

            <!-- Payment Method -->
            <div class="input-section">
                <div class="input-label">
                    <span class="step-number">3</span>
                    Payment Method
                </div>
                <div class="payment-toggle">
                    <input type="checkbox" id="payByCard" onchange="calculatePrice()">
                    <label for="payByCard">üí≥ Customer paying by card (adds processing fee)</label>
                </div>
            </div>
            
            <!-- Results -->
            <div class="results-section" id="results" style="display: none;">
                <button class="show-breakdown-btn" id="breakdownBtn" onclick="toggleBreakdown()">
                    üìä Show Detailed Breakdown
                </button>
                
                <div class="breakdown" id="breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Job effort</span>
                        <span class="breakdown-value" id="jobEffort">‚Äî</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Labor (base rate √ó effort)</span>
                        <span class="breakdown-value" id="laborCost">$0</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Materials (cost + <span id="cmPercent">15</span>% cushion)</span>
                        <span class="breakdown-value" id="materialsCost">$0</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Subtotal (before fees)</span>
                        <span class="breakdown-value" id="subtotalAmount">$0</span>
                    </div>
                    <div class="breakdown-item" id="cardFeeRow" style="display: none;">
                        <span class="breakdown-label">Card processing fee (<span id="feePercent">3</span>%)</span>
                        <span class="breakdown-value" id="cardFeeAmount">$0</span>
                    </div>
                </div>
                
                <div class="final-price">
                    <div class="final-price-label">Quote This Price</div>
                    <div class="final-price-amount" id="finalPrice">$0</div>
                </div>
                
                <div class="warning" id="minimumWarning">
                    <span class="warning-icon">‚ö†Ô∏è</span>
                    <div>
                        <strong>Price adjusted to $250 minimum</strong><br>
                        <small>All jobs must be at least $250 to cover business costs</small>
                    </div>
                </div>
            </div>
            
            <button class="reset-button" onclick="resetCalculator()">Clear & Start Over</button>
        </div>
    </div>
    
    <script>
        // Whiteboard pricing model implementation
        const MINIMUM_CHARGE = 250;

        // Load setup from localStorage or use defaults
        function loadSetup() {
            const saved = localStorage.getItem('pricingModelSetup');
            if (saved) {
                const params = JSON.parse(saved);
                document.getElementById('setupF').value = params.F;
                document.getElementById('setupP').value = params.P;
                document.getElementById('setupD').value = params.D;
                document.getElementById('setupSc').value = params.Sc;
                document.getElementById('setupCb').value = params.Cb;
                document.getElementById('setupCm').value = params.Cm;
                document.getElementById('setupF_fee').value = params.f;
                document.getElementById('setupHday').value = params.Hday;
                document.getElementById('setupCrewSize').value = params.crewSize;
            }
            updateCalculatedRates();
        }

        // Save setup to localStorage
        function saveSetup() {
            const params = getSetupParams();
            localStorage.setItem('pricingModelSetup', JSON.stringify(params));
            updateCalculatedRates();
            calculatePrice();
        }

        // Get current setup parameters
        function getSetupParams() {
            return {
                F: parseFloat(document.getElementById('setupF').value) || 7739,
                P: parseFloat(document.getElementById('setupP').value) || 5000,
                D: parseFloat(document.getElementById('setupD').value) || 20,
                Sc: parseFloat(document.getElementById('setupSc').value) || 0.85,
                Cb: parseFloat(document.getElementById('setupCb').value) || 0.10,
                Cm: parseFloat(document.getElementById('setupCm').value) || 0.15,
                f: parseFloat(document.getElementById('setupF_fee').value) || 0.03,
                Hday: parseFloat(document.getElementById('setupHday').value) || 7.5,
                crewSize: parseFloat(document.getElementById('setupCrewSize').value) || 2
            };
        }

        // Calculate and display B_day and B_personHour
        function updateCalculatedRates() {
            const params = getSetupParams();
            const Bday = (1 + params.Cb) * (params.F + params.P) / (params.Sc * params.D);
            const BpersonHour = Bday / (params.Hday * params.crewSize);

            document.getElementById('calcBday').textContent = `$${Bday.toFixed(2)}`;
            document.getElementById('calcBpersonHour').textContent = `$${BpersonHour.toFixed(2)}`;
        }

        // Toggle setup section
        function toggleSetup() {
            const content = document.getElementById('setupContent');
            const toggle = document.getElementById('setupToggle');

            if (content.classList.contains('show')) {
                content.classList.remove('show');
                toggle.classList.remove('open');
            } else {
                content.classList.add('show');
                toggle.classList.add('open');
            }
        }

        // Toggle multi-day input
        function toggleMultiDay() {
            const isChecked = document.getElementById('multiDay').checked;
            const multiDayInput = document.getElementById('multiDayInput');
            const hoursInput = document.getElementById('hours');

            if (isChecked) {
                multiDayInput.style.display = 'block';
                hoursInput.disabled = true;
                hoursInput.style.opacity = '0.5';
                calculateMultiDayHours();
            } else {
                multiDayInput.style.display = 'none';
                hoursInput.disabled = false;
                hoursInput.style.opacity = '1';
                calculatePrice();
            }
        }

        // Calculate hours for multi-day jobs
        function calculateMultiDayHours() {
            const params = getSetupParams();
            const crewSize = parseFloat(document.getElementById('crewSize').value) || 1;
            const days = parseFloat(document.getElementById('days').value) || 1;
            const totalHours = crewSize * days * params.Hday;
            document.getElementById('hours').value = totalHours;
            calculatePrice();
        }

        // Set multi-day preset
        function setMultiDay(crew, days) {
            document.getElementById('crewSize').value = crew;
            document.getElementById('days').value = days;
            calculateMultiDayHours();
        }

        // Toggle breakdown visibility
        function toggleBreakdown() {
            const breakdown = document.getElementById('breakdown');
            const button = document.getElementById('breakdownBtn');

            if (breakdown.classList.contains('show')) {
                breakdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'üìä Show Detailed Breakdown';
            } else {
                breakdown.classList.add('show');
                button.classList.add('active');
                button.innerHTML = 'üìä Hide Detailed Breakdown';
            }
        }

        // Quick set functions
        function setHours(value) {
            document.getElementById('hours').value = value;
            calculatePrice();
        }

        function setMaterials(value) {
            document.getElementById('materials').value = value;
            calculatePrice();
        }

        // Main calculation function using whiteboard model
        function calculatePrice() {
            const hours = parseFloat(document.getElementById('hours').value) || 0;
            const materialsCost = parseFloat(document.getElementById('materials').value) || 0;
            const payByCard = document.getElementById('payByCard').checked;

            if (hours === 0 && materialsCost === 0) {
                document.getElementById('results').style.display = 'none';
                return;
            }

            const params = getSetupParams();

            // Calculate base rates using whiteboard formula
            // B_day = (1 + C_b)(F + P) / (S_c * D)
            const Bday = (1 + params.Cb) * (params.F + params.P) / (params.Sc * params.D);
            const BpersonHour = Bday / (params.Hday * params.crewSize);

            // Determine if we're using multi-day mode
            const isMultiDay = document.getElementById('multiDay').checked;
            let labor, jobEffortText;

            if (isMultiDay) {
                const crewSize = parseFloat(document.getElementById('crewSize').value) || 1;
                const days = parseFloat(document.getElementById('days').value) || 1;
                const crewDays = crewSize * days;
                labor = crewDays * Bday;
                jobEffortText = `${crewSize} √ó ${days} days = ${crewDays.toFixed(1)} crew-days`;
            } else {
                // Convert hours to person-hours based on setup crew size
                const personHours = hours;
                labor = personHours * BpersonHour;
                jobEffortText = `${hours} person-hours`;
            }

            // Materials with cushion: (1 + C_m) * M
            const materialsWithCushion = (1 + params.Cm) * materialsCost;

            // Subtotal
            const subtotal = labor + materialsWithCushion;

            // Apply card fee if selected: total = subtotal / (1 - f)
            let finalPrice = payByCard ? subtotal / (1 - params.f) : subtotal;
            const cardFee = payByCard ? (finalPrice - subtotal) : 0;

            // Apply minimum charge
            const belowMinimum = finalPrice < MINIMUM_CHARGE && finalPrice > 0;
            if (belowMinimum) {
                finalPrice = MINIMUM_CHARGE;
            }

            // Round to nearest $10
            finalPrice = Math.round(finalPrice / 10) * 10;

            // Update display
            document.getElementById('jobEffort').textContent = jobEffortText;
            document.getElementById('laborCost').textContent = `$${labor.toFixed(0)}`;
            document.getElementById('materialsCost').textContent = `$${materialsWithCushion.toFixed(0)}`;
            document.getElementById('cmPercent').textContent = (params.Cm * 100).toFixed(0);
            document.getElementById('subtotalAmount').textContent = `$${subtotal.toFixed(0)}`;

            // Card fee row
            const cardFeeRow = document.getElementById('cardFeeRow');
            if (payByCard) {
                cardFeeRow.style.display = 'flex';
                document.getElementById('cardFeeAmount').textContent = `$${cardFee.toFixed(0)}`;
                document.getElementById('feePercent').textContent = (params.f * 100).toFixed(1);
            } else {
                cardFeeRow.style.display = 'none';
            }

            document.getElementById('finalPrice').textContent = `$${finalPrice.toFixed(0)}`;

            // Show/hide minimum warning
            document.getElementById('minimumWarning').style.display = belowMinimum ? 'flex' : 'none';

            // Show results
            document.getElementById('results').style.display = 'block';
        }

        // Reset function
        function resetCalculator() {
            document.getElementById('hours').value = '';
            document.getElementById('materials').value = '';
            document.getElementById('payByCard').checked = false;
            document.getElementById('results').style.display = 'none';
            // Reset breakdown visibility
            document.getElementById('breakdown').classList.remove('show');
            document.getElementById('breakdownBtn').classList.remove('active');
            document.getElementById('breakdownBtn').innerHTML = 'üìä Show Detailed Breakdown';
            // Reset multi-day
            document.getElementById('multiDay').checked = false;
            document.getElementById('multiDayInput').style.display = 'none';
            document.getElementById('hours').disabled = false;
            document.getElementById('hours').style.opacity = '1';
            document.getElementById('crewSize').value = 1;
            document.getElementById('days').value = 1;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSetup();

            // Add event listeners
            document.getElementById('hours').addEventListener('input', calculatePrice);
            document.getElementById('materials').addEventListener('input', calculatePrice);
            document.getElementById('crewSize').addEventListener('input', calculateMultiDayHours);
            document.getElementById('days').addEventListener('input', calculateMultiDayHours);

            // Prevent negative numbers
            document.getElementById('hours').addEventListener('change', function() {
                if (this.value < 0) this.value = 0;
            });

            document.getElementById('materials').addEventListener('change', function() {
                if (this.value < 0) this.value = 0;
            });
        });
    </script>
</body>
</html>
